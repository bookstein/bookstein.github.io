
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Emily Bookstein's blog and website  | Blogstein</title>

<meta name="author" content="Emily Bookstein"> 

<meta name="description" content="This week I worked on and helped publish a node module for pushing source maps to a public API. It’s only the second time I’ve worked on a from- &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Blogstein" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Blogstein</a></h1>
<h4>Emily Bookstein's blog and website</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
    <li><a href="/tech-diversity-and-social-justice">Tech + Social Justice</a></li>
	<li><a href="/stuff">Stuff</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
    <li><a href="/tech-diversity-and-social-justice">Tech + Social Justice</a></li>
	<li><a href="/stuff">Stuff</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:bookstein.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><!-- EDIT THIS PAGE FOR ROOT INDEX PAGE (localhost:4000/) -->



    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/03/11/node-modules/">
		
			Node Modules</a>
	</h2>
	<div class="entry-content">
		<p>This week I worked on and helped publish a <a href="https://www.npmjs.com/package/@newrelic/publish-sourcemap">node module for pushing source maps</a> to a public API. It’s only the second time I’ve worked on a from-scratch node module, and it’s enlightening — like pulling back the curtain to reveal the truth behind the Wizard of Oz.</p>

<p>Node modules aren’t magical (though they&rsquo;re no humbugs either). They fulfill a pretty specific purpose: a way to encapsulate reusable code in a way that’s easily managed.</p>

<h3>Why node modules matter</h3>

<p>Before node modules were really a thing, reusable code snippets were often pulled out into Immediately Invoked Function Expressions (IIFEs) or stored inside of variables (the Revealing Module pattern).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">sayAName</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>     <span class="kd">var</span> <span class="nx">privateName</span> <span class="o">=</span> <span class="s1">&#39;name is not set yet&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>     <span class="kd">function</span> <span class="nx">publicSetName</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">privateName</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="kd">function</span> <span class="nx">publicSayName</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hi, &#39;</span> <span class="o">+</span> <span class="nx">privateName</span><span class="p">);</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">setName</span><span class="o">:</span> <span class="nx">publicSetName</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">sayName</span><span class="o">:</span> <span class="nx">publicSayName</span>
</span><span class='line'>     <span class="p">};</span>
</span><span class='line'><span class="p">})()</span>
</span><span class='line'>
</span><span class='line'><span class="nx">sayAName</span><span class="p">.</span><span class="nx">setName</span><span class="p">(</span><span class="s1">&#39;emily&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">sayAName</span><span class="p">.</span><span class="nx">sayName</span><span class="p">()</span>
</span><span class='line'><span class="c1">// &#39;emily&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Example inspired by <a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#revealingmodulepatternjavascript">Addy Osmani&rsquo;s Design Patterns</a></h5>

<p>But with this pattern, you don’t have much ability to manage dependencies or make explicit versioning changes. That’s where node modules are so handy. Not only is the code easily reusable and self-contained, but a version change is as easy as bumping a number in the package.json.</p>

<p>Node modules come in a couple different formats, but the new ES6 format is the one I’m most familiar with.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// lib/bye.js</span>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span> <span class="nx">sayGoodbye</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Bye&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// app.js</span>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span> <span class="nx">sayGoodbye</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./lib/bye&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ES6’s native module format uses <code>export</code> and <code>import</code> tokens to share consts, functions, and objects between files.</p>

<p>(I’ve also used <code>module.exports</code> and <code>require</code>, the CommonJS module format, in various projects depending on whether we&rsquo;re transpiling to support ES5.)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">dep1</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./dep1&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">dep2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./dep2&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Publishing node modules</h3>

<p>Publishing a node module to npm is a pretty sweet feeling &ndash; like getting a book published, except much easier. Although versioning comes with its own quirks.</p>

<p>When working on the node module for pushing source maps, we made several small changes to the 4.0.1 release to fix some tiny bugs. We published those changes to <a href="npmjs.com">npm</a> as pre-releases, indicating that the changes were not yet stable. The pre-release version numbers looked like this: <code>4.0.1-2</code></p>

<p>When you installed <code>@latest</code> or an unspecified version number, though, you got the pre-release instead of the release (4.0.1). That’s not ideal behavior; you want people to be able to opt into prereleases.</p>

<p>Here’s the trick: when publishing to npm, you can tag a release with <code>prerelease</code> or ‘next’ explicitly, which will override the default tag of <code>latest</code>. Then you can make incremental changes to your heart’s content until it’s time for the next real version bump!</p>

<h3>Sources</h3>

<ul>
<li><a href="http://jvandemo.com/a-10-minute-primer-to-javascript-modules-module-formats-module-loaders-and-module-bundlers">http://jvandemo.com/a-10-minute-primer-to-javascript-modules-module-formats-module-loaders-and-module-bundlers</a></li>
<li><a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#revealingmodulepatternjavascript">https://addyosmani.com/resources/essentialjsdesignpatterns/book/#revealingmodulepatternjavascript</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-03-11T15:57:07-08:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/node/'>node</a>, <a class='category' href='/blog/categories/npm/'>npm</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/02/23/gosh-yarn-it/">
		
			Gosh Yarn It</a>
	</h2>
	<div class="entry-content">
		<p>You&rsquo;ll never believe it&hellip; A hot new technology has appeared on the Javascript scene.</p>

<h3>What is yarn?</h3>

<p><a href="https://github.com/yarnpkg/yarn">Yarn</a> is a replacement for the <a href="https://www.npmjs.com/package/npm">npm package manager</a>, the  popular tool used to handle the ~300,000 packages in the npm registry.</p>

<p>While Yarn is designed completely replace the npm workflow, it works in concert with the existing package.json: adding or removing packages with Yarn will update both the <em>package.json</em> and <em>yarn.lock</em>.</p>

<p>The main commands you&rsquo;ll need:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">yarn</span>  <span class="c1">// same as npm install</span>
</span><span class='line'><span class="nx">yarn</span> <span class="nx">add</span>  <span class="c1">// same as npm i --save</span>
</span><span class='line'><span class="nx">yarn</span> <span class="nx">add</span> <span class="o">--</span><span class="nx">dev</span>  <span class="c1">// same as npm i --save-dev</span>
</span><span class='line'><span class="nx">yarn</span> <span class="nx">remove</span>  <span class="c1">// same as npm uninstall</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Why bother to switch from tried-and-true npm?</h3>

<p>Locking down the right versions of all your dependencies can be tricky.</p>

<p>For example: I accidentally upgraded <em>react-addons-test-utils</em> to a new version by adding it directly with <code>yarn add react-addons-test-utils</code>. This got the latest version of the package, which meant it no longer had the same version number as <em>react</em> and <em>react-dom</em> &ndash; we had specifically pinned those at an earlier minor version.</p>

<p>When I ran the tests, this error popped up:
<code>Module not found: Error: Cannot resolve module 'react-dom/lib/ReactTestUtils' in /Users/ebookstein/newrelic/browser/overview-page/node_modules/react-addons-test-utils (module was moved between versions of react-dom)</code></p>

<p>To pin <em>react-addons-test-utils</em> at a specific version, I added the version to the package name like this: <code>yarn add react-addons-test-utils@15.3.0</code>.</p>

<p>Of course, locking down dependencies at the right version numbers is something that <em>npm</em> did for us as well. Why replace it?</p>

<p>There are some minor benefits that came across right away from using yarn instead of npm. For one thing, I no longer have to remember <code>--save</code> &ndash; think of all the time you&rsquo;ll save <em>not</em> pushing branches up to Github only to have your tests fail!</p>

<p>But there are some big-picture benefits too. We were using <em>npm shrinkwrap</em> to stabilize versions and dependencies. But shrinkwrap easily gets out of sync with <em>package.json</em> if you forget to run <code>npm shrinkwrap</code>, and when it fails, it fails silently.</p>

<p>If you want the full-length list of big-picture reasons that Facebook came up with, check out <a href="https://code.facebook.com/posts/1840075619545360/yarn-a-new-package-manager-for-javascript">their blog post about yarn</a>.</p>

<h3>Switching to yarn: a few tricky bits</h3>

<p>Installing yarn itself is easy.</p>

<p><code>brew install yarn</code></p>

<p>Then go to your project directory and run <code>yarn</code> to install all the packages and generate a <em>yarn.lock</em> (similar to Bundler&rsquo;s <em>Gemfile.lock</em> for Ruby).</p>

<p>Migrating from npm to yarn is not totally seamless, however. For some reason, a few packages don’t transition as easily. In particular I had issues with <em>node-sass</em> and <em>phantom-js</em>. In one case, the issue was resolved by specifically adding the module with yarn (<code>yarn add node-sass</code>). In the case of <code>phantom-js</code>, though, we had to add a post-install script to our <em>package.json</em> that would run a phantomjs install script.</p>

<p>Also, if you use Jenkins or other tools that keep a saved copy of your node_modules, you might have to clear out the old node_modules and reinstall.</p>

<p>For Jenkins specifically, try:</p>

<ol>
<li>clearing the workspace,</li>
<li>killing the instance of Jenkins, or</li>
<li>add a post-build step to delete the workspace every time (which therefore runs a complete installation every time)</li>
</ol>


<h3>Fun bits</h3>

<p>Fun fact: yarn preserves many helpful features of npm, like <a href="https://yarnpkg.com/lang/en/docs/cli/link/">symlinking</a>.</p>

<p>For example, if you wanted to use your personal copy of <em>react</em> instead of Facebook’s <em>react</em> (pretend!), then you could run <code>yarn link</code> inside of the react directory, then <code>yarn link react</code> in your project directory. This would then substitute a link to your personal <em>react</em> copy for every <code>require(react)</code>.</p>

<h3>Tying up loose ends</h3>

<p>So far, it&rsquo;s been fun to knit yarn into our development process! Though I&rsquo;m still working through some of the knots&hellip;</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-02-23T08:26:15-08:00" pubdate data-updated="true"></time></div>
	


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/02/09/event-loop/">
		
			Whoop Whoop! Event Loop!</a>
	</h2>
	<div class="entry-content">
		<p>Last week a friend asked me, <em>Is Node is multi-threaded? How would Node do asynchronous work if it&rsquo;s not multi-threaded?</em> Good question! I didn&rsquo;t know the answer.</p>

<p>But as it turns out, Node (and Javascript in general) is <strong>single-threaded</strong>. This means there is only one process, one flow of control. Instead of having multiple threads to process simultaneous work, the Node runtime environment has an ecosystem of interconnected data structures that preserve a fast workflow. At the conceptual center of these structures is the event loop.</p>

<p>All modern Javascript engines rely on an event loop concurrency model, not just Node. So, browser-lovers, read on.</p>

<h2>A stack, a queue, an event loop - oh my!</h2>

<p><img class="[Event loop]" src="/images/event_loop_mdn.png" width="494"></p>

<h6>Image: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop">Mozilla Developers Network</a> (annotations mine)</h6>

<p>This is a simplified diagram of a Javascript runtime. (I added the &ldquo;Web APIs&rdquo; box for browser-related completeness.)</p>

<p>Start with the <strong>stack</strong>. You&rsquo;ve probably been exposed to the stack before, especially in the form of <em>stack traces</em> for  Javascript errors. A stack trace, like the stack itself, is made of the series of functions and local variables that have been pushed onto the stack. Each of those functions and its local variables make up a <em>frame</em> in the call stack.</p>

<p>Functions are added to the stack from the main Javascript program &ndash; or, from the message queue. The <strong>queue</strong> contains callback functions that are ready to be, well, &ldquo;called back.&rdquo; In the browser, callbacks may be associated with DOM events like &ldquo;click&rdquo; or &ldquo;hover&rdquo;; or, for both backend and frontend Javascript, they may be associated with resolved Promises. In fact, they may contain responses from any number of <a href="https://developer.mozilla.org/en-US/docs/Web/API">Web APIs</a>, like <code>timer</code> or the infamous <code>XMLHttpRequest</code>. (I didn&rsquo;t realize those were separate APIs until I started learning about the event loop!) When a message is processed, its callback function gets called and thereby is added to the stack.</p>

<p>The <strong>event loop</strong> is the loop that processes messages in the queue such that the callback functions get pushed onto the stack.</p>

<p>For an animated demo of how the event loop works in the browser, check out <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">Philip Roberts' 2014 JSConf talk</a>.</p>

<p><img class="[Event loop]" src="/images/philip_roberts.png" width="469"></p>

<h6>Image: <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">Philip Roberts, 2014</a></h6>

<h2>Much non-blocking</h2>

<blockquote><p>A very interesting property of the event loop model is that JavaScript, unlike a lot of other languages, never blocks. Handling I/O is typically performed via events and callbacks, so when the application is waiting for an IndexedDB query to return or an XHR request to return, it can still process other things like user input.
&ndash; <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop#Never_blocking">MDN</a></p></blockquote>

<p>Thanks to the event loop model, Javascript is <strong>non-blocking</strong>. That means you don&rsquo;t have to wait for slow tasks to complete before processing other tasks. We just keep pushing or popping frames on and off the stack; some of those function calls add work to someone else&rsquo;s plate (by calling a web API or making HTTP requests, for example), outside of our single process; we receive callbacks in our queue when that external work is done; and whenever the stack has capacity, we pull in those callbacks.</p>

<p>So, even though Javascript is single-threaded, the event loop model allows it to be fast and non-blocking. We just keep grabbing  one thing at a time, one thing at a time, one thing at a time, keep on going forever. We are a <em>machine.</em></p>

<h3>Resources</h3>

<ul>
<li><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">JSConf 2014: What the heck is the event loop anyway?</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop">Concurrent model and Event loop - MDN</a></li>
<li>a knowledgeable coworker who explained aynchronicity and Node</li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-02-09T19:33:19-08:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/node/'>node</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/01/28/testing-an-express-server/">
		
			Testing an Express Server</a>
	</h2>
	<div class="entry-content">
		<p>A couple weeks ago, I wrote a suite of tests for a new Node-Express service.</p>

<p>Up until that point, all the JS testing I&rsquo;d done was for <a href="https://bookstein.github.io/blog/2016/12/20/if-i-only-had-a-test/">React components</a>. Writing tests for an Express app is a little different, but was actually really fun and easy with the right tools. So here&rsquo;s a little write-up on some testing tools and tips for backend Javascript!</p>

<h3>Tools</h3>

<p>You will need one or more of the following tools:</p>

<ul>
<li><a href="https://mochajs.org/">Mocha</a>: a test runner. In package.json, simply add <code>"test": "mocha"</code> under &ldquo;scripts&rdquo; and all tests in the <code>test</code> directory will run.</li>
<li><a href="chaijs.com/">Chai</a>: an assertions library for Javascript, offering both an expect API and an assert API.</li>
<li><a href="https://github.com/visionmedia/supertest">Supertest</a>: an HTTP testing library that lets you easily send HTTP requests to a local server.</li>
<li><a href="www.node-tap.org/">Node-tap</a>: a test library implementing the Test-Anything-Protocol for Node.</li>
</ul>


<h3>Most Valuable Player: Supertest</h3>

<p>My favorite new tool on this list is the Supertest library. It is SO easy to hit each Express endpoint with a Supertest request and examine the response.</p>

<p>The way it works: require Supertest and pass it an Express application. This returns a supertest object onto which other methods can be chained. For example, you can set attributes with &ldquo;get(&lsquo;/path&rsquo;)&rdquo; or &ldquo;set(&lsquo;Content-Type&rsquo;, &lsquo;application/json&rsquo;)&rdquo; that modify both the object and your eventual request to the server. Expectations for the response are also chained onto the supertest object.</p>

<p>With mocha/chai/supertest:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="nx">supertest</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../app&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;gets a 200 response&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="c1">// this returns a SuperTest object</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="err">‘</span><span class="o">/</span><span class="nx">data</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Asynchronicity</h3>

<p>One interesting aspect of writing tests for an Express server is the fact that your tests must run asynchronously. After all, you&rsquo;re sending a request to your server; if your tests proceeded onwards full steam ahead, you might run into an expectation that checks for a response before the response has even arrived. Mocha also needs wait for the current test to finish before heading off to other tests.</p>

<p>Mocha has two ways of handling asynchronous tests:</p>

<ul>
<li>pass in a <code>done</code> callback that is called when the test ends, or</li>
<li>use Mocha&rsquo;s built-in Promise handling.</li>
</ul>


<p>Now that Mocha actually handles Promises in-house, it&rsquo;s considered better practice to use <code>.then</code> and <code>.catch</code> rather than <code>.end(done)</code>.</p>

<p>With mocha/supertest:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="nx">supertest</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../app&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;gets a 200 response&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="err">‘</span><span class="o">/</span><span class="nx">data</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>           <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">))</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="p">}</span> <span class="c1">// make sure to actually throw an error so the test fails</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="k">throw</span> <span class="nx">err</span><span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Node-tap can also be used this way, with <code>.then</code> and <code>.catch</code> callbacks on a Promise.</p>

<p>node-tap/supertest:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="nx">supertest</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;tap&#39;</span><span class="p">).</span><span class="nx">test</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../app&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">test</span><span class="p">(</span><span class="err">‘</span><span class="nx">gets</span> <span class="nx">a</span> <span class="mi">200</span> <span class="nx">response</span><span class="s1">&#39;, (t) =&gt; {</span>
</span><span class='line'><span class="s1">  t.plan(1)</span>
</span><span class='line'><span class="s1">  request(app)</span>
</span><span class='line'><span class="s1">    .get(‘/data&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">t</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">t</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now sit back, relax, and watch your tests run.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-01-28T17:41:40-08:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/express/'>express</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/testing/'>testing</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/01/04/express-is-adorbs/">
		
			Express Is Adorbs</a>
	</h2>
	<div class="entry-content">
		<p>Express is adorable. It&rsquo;s the tiniest, cutest little web framework.</p>

<p>Besides <em>adorable</em>, <a href="http://expressjs.com/">Express</a> is a lightweight web framework for Node.js. It addresses a few basic needs of Node applications.</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> Node        </th>
<th style="text-align:right;"> Express         </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> need to implement whole HTTP server      </td>
<td style="text-align:right;"> convenience methods for easy-to-start server </td>
</tr>
<tr>
<td style="text-align:left;"> need a router to map requests to request handlers      </td>
<td style="text-align:right;"> routes requests to designated handler based on HTTP verb + path     </td>
</tr>
<tr>
<td style="text-align:left;"> need to actually handle requests </td>
<td style="text-align:right;"> callbacks handle requests!      </td>
</tr>
</tbody>
</table>


<h3>Hello world</h3>

<p>A &ldquo;hello world&rdquo; Express server is very simple. Besides the standard <code>package.json</code> + <code>node_modules</code> (libraries) that come with a new Node project, here&rsquo;s all it took:</p>

<p><code>$ npm install express --save</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// app.js</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span> <span class="c1">// creates an Express application</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// `app` has methods like `.get` for routing HTTP requests</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">)</span> <span class="c1">// `req` is an object representing the HTTP request</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;try visiting &quot;</span> <span class="o">+</span> <span class="nx">host</span> <span class="o">+</span> <span class="s2">&quot;/helloworld instead&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/helloworld&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// `res` is an object representing the HTTP response</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// `.listen` is a convenience function that does some stuff to start an HTTP server</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Example app listening on port 3000!&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s all there is to it. Run <code>node app.js</code> on the command line, open up <a href="">localhost:3000</a> in a browser, and you&rsquo;re all set.</p>

<h3>Bonus fun</h3>

<p><code>res</code> and <code>req</code> (the arguments passed into each callback) are pretty powerful objects. Built on Node&rsquo;s own response and request objects, these objects come with helpful methods to read the request or alter the response body.</p>

<p>For example, you can have the response <a href="https://expressjs.com/en/4x/api.html#res.json">send back JSON</a> instead of a regular String:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/json&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;this is json&#39;</span> <span class="p">});</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>I really like the simple route layout that Express encourages. Each route is a simple combination of HTTP verb + path. (A REST best practice, incidentally: keep the URL the same but vary the verb.)</p>

<p>In the following example, when we load and submit an HTML form, we hit two different <code>/upload</code> endpoints.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">form</span> <span class="o">=</span> <span class="err">`</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s1">&#39;/upload&#39;</span> <span class="nx">method</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="nx">Submit</span> <span class="k">this</span> <span class="nx">form</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/form&gt;</span>
</span><span class='line'>  <span class="err">`</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;hello! upload complete&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hello, World (of Express)!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-01-04T21:29:15-08:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/express/'>express</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/12/20/if-i-only-had-a-test/">
		
			React Testing, Part 2</a>
	</h2>
	<div class="entry-content">
		<p><img class="[If I only had a test]" src="/images/if_I_only_had_a_brain.png" width="523" height="392" title="[Scarecrow [Scarecrow]]" ></p>

<h6>Image: <a href="https://www.google.com/url?sa=i&amp;rct=j&amp;q=&amp;esrc=s&amp;source=images&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiNptKjpYPRAhUY5WMKHX-gBY4QjB0IBg&amp;url=http%3A%2F%2Fwww.quickmeme.com%2Fmeme%2F36fr5j&amp;psig=AFQjCNEw6QsdkwrYPoAtlLuhn89jrul6JQ&amp;ust=1482341155914045">Quickmeme</a></h6>

<h5>My last post was titled “Testing React Router: Part 1.” Which seems to imply there&rsquo;s a Part 2 about React Router. But I want to… er… <em>re-route</em> the conversation. This post is about testing React components and how integration tests can save the day.</h5>

<hr />

<p><em>The project was almost complete. My time as team captain was almost over. Victory was in sight&hellip;</em></p>

<p>My team had been working on Source Maps &ldquo;Dragondrop,&rdquo; a UI feature allowing users to drag and drop <a href="https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">source maps</a> to unminify Javascript error stack traces. As the project&rsquo;s team captain, I had generated a list of test cases and scheduled a team &ldquo;bug hunt&rdquo; to go through them manually.</p>

<p>The test plan looked something like this:</p>

<blockquote><ol>
<li>Happy path! Drag and drop the correct source map onto the stack trace.
Verify unminified line #, column #, and source code.</li>
<li>Drag and drop the wrong source map onto the stack trace.
Verify error message banner saying wrong file.</li>
<li>Drag and drop a source map with no source content.
Verify warning banner saying no source content, but correctly unminified line # and column #.</li>
</ol>
</blockquote>

<p>Etc.</p>

<p>Our bug hunt revealed that most test cases passed! But it also revealed a subtly bug&hellip; and that final bug fix ballooned into taking multiple extra days.</p>

<p><em>How could we have caught this UI issue earlier? And what could we do to prevent regressions while we refactored the code to fix the problem?</em></p>

<h3>Testing Front-End Applications Is About User Perspective</h3>

<p>React child components re-render when there&rsquo;s a state change in a parent component. In our app, these children were <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.ouvy9otiu">presentational components</a> called <code>StackTraceItems</code> &ndash; the individual line items of a stack trace. The parent was <code>StackTrace</code>, the container component at the top level of the hierarchy, where we stored uploaded source maps as state.</p>

<p><img class="[source map state]" src="/images/sourcemap_state.png" width="470" height="433" title="[Source maps [source maps]]" ></p>

<h6>Source maps are stored in <code>StackTrace</code> state.</h6>

<p>Here was the problem: when a user dragged in the <em>wrong</em> source map, <code>StackTrace</code> stored the file, applied the source map to the minified stack trace, and then confirmed whether or not unminification had been successful. Even if it was <em>not</em> successful, the state change in <code>StackTrace</code> caused <code>StackTraceItems</code> to update as if a correct source map had been uploaded.</p>

<p>Adding insult to injury, all of our tests were passing.
<img class="[No good]" src="/images/no_good.png" width="25" height="25" title="[No good [No good]]" ></p>

<p>Our tests were passing, all right, but they were all unit tests. All they did was confirm that components rendered properly given certain props, and that user interaction worked as expected. The problem we were facing was that, <em>from a user perspective,</em> the app looked broken.</p>

<h3>How to Write Front-end Tests That Save You Time and Anxiety</h3>

<h4>0. Have the right tools</h4>

<p>These are the libraries and tools that allowed us to write all the React tests we wanted:</p>

<ul>
<li><a href="https://github.com/airbnb/enzyme">Enzyme (React Test Utilities)</a></li>
<li><a href="http://chaijs.com/api/assert/">Chai Assertion Library</a></li>
<li><a href="http://sinonjs.org/">Sinon: Test Spies and Mocks</a></li>
</ul>


<h4>1. Have a basic set of unit tests for every component</h4>

<p>Unit tests are great for testing components in isolation. These tests tell you whether the component renders at all, and that it does <em>X</em> when you click it.</p>

<p>Unit tests should check that:</p>

<ul>
<li>component shallowly renders, given props (Enzyme&rsquo;s <code>shallow</code>)</li>
<li>user interaction works as expected</li>
<li>elements that you want to show/hide will appear or disappear depending on props</li>
</ul>


<p>Keep unit tests basic. And don&rsquo;t rely on unit tests alone.</p>

<h4>2. Add integration tests for all major user flows</h4>

<p>Integration tests are necessary for testing actual user experience. After all, your user is going to experience your app as an holistic piece of software, not in the form of isolated components.</p>

<p>If your app is structured to have just <strong>one source of truth</strong> &ndash; where high-level state changes trigger a cascade of updates to lower-level components &ndash; it&rsquo;s easy to test.</p>

<p>Integration tests should:</p>

<ul>
<li>deep-render your components (Enzyme&rsquo;s <code>mount</code>)</li>
<li>call <code>setState</code> on your top-level stateful component to trigger the changes you want to test</li>
<li>check for props passed to presentational components, thereby validating what we want the user to <strong>see</strong> on the page</li>
</ul>


<p>What clues do you find yourself looking for when you manually test something? What tells you that a code change worked or not? Check for the props behind those visual cues in your integration tests. Your tests should impersonate your user&rsquo;s eyes.</p>

<blockquote><p>&ldquo;Unit testing is great: it’s the best way to see if an algorithm does the right thing every time, or to check our input validation logic, or data transformations, or any other isolated operation. Unit testing is perfect for fundamentals.
But front-end code isn’t about manipulating data. It’s about user events and rendering the right views at the right time. Front-ends are about users.&rdquo;
&ndash; <a href="https://www.toptal.com/react/how-react-components-make-ui-testing-easy">Toptal.com</a></p></blockquote>

<h4>3. Don&rsquo;t leave integration tests until the end</h4>

<p>We were about 2/3 of the way through the project when I wrote up our bug-hunt test plan. The team went through the test plan twice in QA bug hunts, where it was easy as pie to find the last remaining bugs and UX fixes.</p>

<p>But that test plan should have doubled as an outline for integration tests right away. In fact, writing the integration tests should have happened at <em>about the same point in the project</em> as coming up with the test plan. That way, all that high-level testing would have been automated for future use, and at a point in the project when we had a good sense of our app&rsquo;s major user flows and potential pitfalls!</p>

<h3>In Summary</h3>

<p>Unit tests are a great baseline. But we needed <strong>integration tests</strong> to allow us to refactor boldly, as well as save us time in manual testing along the way.</p>

<p>Writing tests during a fast-paced project always feels like a roadblock on your journey down the yellow-brick road. But taking that time might be the only way you get back to Kansas all in one piece.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-12-20T09:25:52-08:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/11/30/testing-react-router-1/">
		
			Testing React Router: Part 1</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;m a believer.</p>

<p>I have joined the ranks of those who see the URL as the One Almighty Source of Truth. In this vein, we use <a href="https://github.com/ReactTraining/react-router">React Router</a> to determine which components and data to show.</p>

<p>But even though I&rsquo;m a believer, I&rsquo;m also a cynic. Let&rsquo;s put our faith in the URL to the test.</p>

<h3>Why should we test our routing?</h3>

<p>With the URL as the source of truth, we can expect the view to significantly change depending on the URL path or query params. Shouldn&rsquo;t we have tests that ensure the correct components show up? Especially if you have complicated routing: nested routes, query params, optional routes, etc.</p>

<h3>Initial exploration</h3>

<p>The folks who wrote React Router wrote a <a href="https://github.com/ReactTraining/react-router/blob/master/modules/__tests__/matchRoutes-test.js">set of tests</a> that verify whether a matching route can be found for a given path.</p>

<p>For example, here&rsquo;s a test that verifies that a path of <code>/users</code> will yield the correct set of matching routes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">routes</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'> <span class="nx">RootRoute</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">childRoutes</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>      <span class="nx">UsersRoute</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">indexRoute</span><span class="o">:</span> <span class="p">(</span><span class="nx">UsersIndexRoute</span> <span class="o">=</span> <span class="p">{}),</span>
</span><span class='line'>        <span class="nx">childRoutes</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>          <span class="nx">UserRoute</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;:userID&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;when the location matches an index route&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;matches the correct routes&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">matchRoutes</span><span class="p">(</span><span class="nx">routes</span><span class="p">,</span> <span class="nx">createLocation</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">expect</span><span class="p">(</span><span class="nx">match</span><span class="p">).</span><span class="nx">toExist</span><span class="p">()</span>
</span><span class='line'>          <span class="nx">expect</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">routes</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span> <span class="nx">RootRoute</span><span class="p">,</span> <span class="nx">UsersRoute</span><span class="p">,</span> <span class="nx">UsersIndexRoute</span> <span class="p">])</span>
</span><span class='line'>          <span class="nx">done</span><span class="p">()</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<h6>See the full React Router test <a href="https://github.com/ReactTraining/react-router/blob/master/modules/__tests__/matchRoutes-test.js">here</a>.</h6>

<p>I couldn&rsquo;t find much out there on the Interwebz about testing React routes. So, my first step was to see if I could just get React Router&rsquo;s &ldquo;matching routes&rdquo; test suite working for an existing app that has its own simple front-end routing.</p>

<p>It was a bit of a struggle.</p>

<p>The most important part was to convert the routes in <code>routes.js</code> to JSON instead of JSX. This is because React Router&rsquo;s tests use a <code>matchRoutes</code> testing tool that rely on routes having a certain structure. Their test suite recreates a complicated nest of test routes inside the test itself. If I were writing my own routes test, it would be pretty annoying to have to update a handmade list of routes in the test every time the app&rsquo;s routes changed. Writing routes as JSON will allow me to simply import my routes from the routes file into the test.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// in routes.js</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kr">const</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nx">component</span><span class="o">:</span> <span class="nx">App</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">onEnter</span><span class="o">:</span> <span class="nx">trackUserId</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">childRoutes</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">component</span><span class="o">:</span> <span class="s2">&quot;LandingPageComponent&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/buy&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">component</span><span class="o">:</span> <span class="s2">&quot;BuyComponent&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// in __test__/routes_spec.js</span>
</span><span class='line'>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span> <span class="nx">Routes</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../routes&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="nx">matchRoutes</span><span class="p">(</span><span class="nx">Routes</span><span class="p">,</span> <span class="nx">createLocation</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">match</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h3>What to test?</h3>

<p>I don&rsquo;t want my routes test to test <em>React Router</em>&rsquo;s logic &ndash; it&rsquo;s not my place to make sure that React Router knows how to find a matching route from a given path. I want to test the logic that I&rsquo;m creating for the app. So, what I <em>do</em> want to test is that all the right information is displayed on the page if I hit the &ldquo;/&rdquo; path versus the &ldquo;/buy&rdquo; path.</p>

<p>For example, I could check that loading &ldquo;/buy&rdquo; adds the <code>SearchWidget</code> and <code>ShoppingCartWidget</code> to the page, and that hitting the root &ldquo;/&rdquo; shows the <code>FullPageSplashComponent</code>.</p>

<p>But HOW to do that? Stay tuned, more to come.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-11-30T10:20:31-08:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/react/'>react</a>, <a class='category' href='/blog/categories/react-router/'>react-router</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/11/01/es6-magic/">
		
			3 Handy Spells for the Aspiring ES6 Wizard</a>
	</h2>
	<div class="entry-content">
		<p><img class="[Hermione casting a spell]" src="/images/hermione.jpg" width="338" height="478" title="[Hermione [Hermione]]" ></p>

<h6>Image: <a href="http://harry-potter-fanart.tumblr.com/post/135838347291/hermione-granger-by-fridouw">Harry Potter FanArt by fridouw</a></h6>

<p>Hermione might have read a whole book on Arithmancy, but the spells that save the day always seem to boil down to <em>Alohamora</em>, <em>Expelliarmus</em> and <em>Expecto Patronum</em>.</p>

<p>Just like every wizard needs her shortlist of handy spells, there are a couple of new Javascript features that might just disarm Voldemort, save Hogwarts, and/or beautify your code every damn day.</p>

<p>Here are 3 particularly magical aspects of ES6 that will brighten your day faster than you can say <em>Lumos</em>!</p>

<ul>
<li><a href="#arrow_functions">arrow functions</a>,</li>
<li><a href="#destructuring">object destructuring</a></li>
<li><a href="#variables">variable scoping</a></li>
</ul>


<h3><a name="arrow_functions"></a>Arrow functions</h3>

<p>In addition to defining functions with the <code>function</code> keyword, you can now define functions using arrow notation.</p>

<h4>Old way:</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">doAThing</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">“</span><span class="nx">Doing</span> <span class="nx">a</span> <span class="nx">thing</span> <span class="nx">now</span><span class="s2">&quot;)</span>
</span><span class='line'><span class="s2">     console.log(“Done&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Arrow way:</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">doAThing</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">“</span><span class="nx">Doing</span> <span class="nx">a</span> <span class="nx">thing</span> <span class="nx">now</span><span class="s2">&quot;)</span>
</span><span class='line'><span class="s2">     console.log(“Done&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>(If you’ve used lambdas in Java 8, the setup will feel familiar.)</p>

<p>Arrow functions have 2 simple benefits and 1 complicated benefit.</p>

<h4>Simple benefit 1: less writing</h4>

<p>We get rid of the <code>function</code> keyword! So fly, so hip!</p>

<h4>Simple benefit 2: implicit returns</h4>

<p>You can write one-liners like this, without curly braces:
<code>returnAString = () =&gt; “Here's your string”</code></p>

<h4>Complicated benefit: no re-binding of <code>this</code></h4>

<p>Arrow functions should <strong>not</strong> be used as a one-to-one replacement for regular functions because they affect the scope of <code>this</code>.</p>

<p>In old-school Javascript functions, <code>this</code> refers to the local scope.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="err">‘</span><span class="p">.</span><span class="nx">myDiv</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="err">‘</span><span class="nx">click</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="c1">// —&gt; &lt;div class=‘myDiv&#39;&gt; Hi &lt;/div&gt;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>An arrow function doesn&rsquo;t create its own context, so the value of <code>this</code> is simply inherited from the parent scope.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="err">‘</span><span class="nx">div</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'><span class="nx">div</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="err">‘</span><span class="nx">click</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="c1">// —&gt; window</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, be careful about using arrow functions, particularly when using event listeners.</p>

<h3><a name="destructuring"></a>Object destructuring</h3>

<p>Object destructuring is super handy. It saves you a lot of writing, and it saves a lot of headaches when it comes to passing arguments into functions and returning values from functions.</p>

<h4>Less writing</h4>

<p>Old way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">thing1</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">thing1</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">thing2</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">thing2</span>
</span></code></pre></td></tr></table></div></figure>


<p>New way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="p">{</span> <span class="nx">thing1</span><span class="p">,</span> <span class="nx">thing2</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">obj</span>
</span></code></pre></td></tr></table></div></figure>


<p>ES6 simply looks inside <code>obj</code> for properties with names matching <code>thing1</code> and <code>thing2</code> and assigns the correct value.</p>

<h4>Multiple return values</h4>

<p>Object destructuring helps us unpack multiple values returned from a function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">returnObj</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>     <span class="k">return</span> <span class="p">{</span> <span class="nx">thing1</span><span class="o">:</span> <span class="s1">&#39;red fish&#39;</span><span class="p">,</span> <span class="nx">thing2</span><span class="o">:</span> <span class="s1">&#39;blue fish&#39;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="p">{</span> <span class="nx">thing1</span><span class="p">,</span> <span class="nx">thing2</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">returnObj</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">thing1</span><span class="p">)</span> <span class="c1">// &#39;red fish&#39;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">thing2</span><span class="p">)</span>  <span class="c1">// &#39;blue fish&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Passing in arguments</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">tipCalculator</span><span class="p">(</span> <span class="p">{</span> <span class="nx">total</span><span class="p">,</span> <span class="nx">tip</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span> <span class="nx">tax</span> <span class="o">=</span> <span class="mf">0.11</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>     <span class="k">return</span> <span class="nx">total</span> <span class="o">*</span> <span class="nx">tip</span> <span class="o">+</span> <span class="nx">total</span> <span class="o">*</span> <span class="nx">tax</span> <span class="o">+</span> <span class="nx">total</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">bill</span> <span class="o">=</span> <span class="nx">tipCalculator</span><span class="p">(</span> <span class="p">{</span><span class="nx">tax</span><span class="o">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="nx">total</span><span class="o">:</span> <span class="mi">200</span><span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, we pass in an object to the function <code>tipCalculator</code> and the argument gets destructured inside the function. This allows arguments to be passed in any order — and you can even rely on defaults so you don’t have to pass in every value.</p>

<h3><a name="variables"></a>Var/let/const: variable scoping</h3>

<p>ES6&rsquo;s variable declaration keywords <code>var</code>, <code>let</code> and <code>const</code> allow you to declare variables with a variety of scoping and overwriting rules.</p>

<ul>
<li><p><code>var</code> is function-scoped</p>

<ul>
<li>if not declared inside a function, the variable is global</li>
</ul>
</li>
<li><p><code>let</code> has a block scope</p>

<ul>
<li>the variable is only defined inside whatever block it&rsquo;s in (including <code>if</code> blocks)</li>
<li>you cannot define same variable multiple times using <code>let</code> in the same scope</li>
</ul>
</li>
<li><p><code>const</code> (“constant”) variables cannot be re-assigned a value</p>

<ul>
<li>properties of a const <strong>can</strong> be changed though!</li>
</ul>
</li>
</ul>


<p>The rule of thumb I’ve been using: by default, assign your variables using <code>const</code> unless you know the value is going to change. (I <code>const</code>antly use <code>const</code>!)</p>

<p>This way, I never accidentally overwrite a variable whose value I never wanted to change, and I am forced to make a conscious decision at the outset about how to use variables.</p>

<p>If I want to declare a variable and set its value later (based on if/else logic, for example), I use <code>let</code>. (I almost never use <code>var</code>.)</p>

<h3>Summary</h3>

<p>ES6 has a ton of awesome, time-saving shortcuts built into it &ndash; shortcuts that any worthy wizard would make sure to add to her spellbook. These magical tools aren’t just esoteric/academic fluff — I use them all the time, and I’m a first year myself.</p>

<p>P.S. If you want a tutorial overview of ES6, I’m really enjoying <a href="https://es6.io/">es6.io</a> by Wes Bos (who inspired some of my examples above). The tutorial is easy to follow, and it not only teaches you about ES6’s new features but is basically a Javascript crash course in itself. It&rsquo;ll totally <em>transfigure</em> your ES6 familiarity!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-11-01T21:59:17-07:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/es6/'>es6</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/10/20/navigation-timing-api/">
		
			Navigation Timing API</a>
	</h2>
	<div class="entry-content">
		<p>Learning about the Navigation Timing API is surprisingly similar to learning “how the Internet works.” In fact, if I was asked to sketch &ldquo;how the Internet works&rdquo; as a job interview question, I&rsquo;d probably draw a timeline of events pretty similar to this:</p>

<p><img class="[Navigation Timing API]" src="/images/navtimingapi1.png" width="740" height="353" title="[Navigation Timing API [diagram]]" ></p>

<h6>Image: <a href="https://www.w3.org/TR/navigation-timing/">W3C Navigation Timing</a></h6>

<p>Which, of course, is how the Navigation Timing API views the world, too.</p>

<p>The <a href="https://www.w3.org/TR/navigation-timing/">Navigation Timing API</a> is an API that tracks navigation and page load timing. It’s especially useful for gathering information about the wait time perceived by the end user. Timestamps from along the page-load timeline (see diagram above) are stored in an object in the browser window, <code>window.performance.timing</code>. Doing some simple math using those timestamps can reveal the wait times hidden in parts of the process between clicking a link and seeing the fully-loaded page.</p>

<p>The <code>navigationStart</code> timestamp is collected the moment that the previous document is unloaded and the new page fetch begins. The browser looks in the cache, does a DNS lookup if it can&rsquo;t find an entry, connects to the identified server, sends a request, receives the response (in bytes), and then processes the response into the fully-loaded page. All of these steps, and the transitions between them, are identified by events fired off by the browser. The Navigation Timing API notes these events and stores them as start and end times inside <code>window.performance.timing</code>.</p>

<p>The Navigation Timing API ends with the window’s <code>load</code> event, which fires when the DOM is complete and all images, scripts and links have loaded. However, many webpages continue to fire off AJAX calls after the page has loaded. AJAX calls might even <em>replace</em> additional page loads, as in the case of single-page apps where the full page loads only once.</p>

<p><img class="[Navigation Timing API]" src="/images/navtimingapi.png" width="740" height="353" title="[Navigation Timing API [diagram]]" ></p>

<p>These asynchronous, post-DOM-load requests might make it harder to understand total page load performance, but it&rsquo;s not too difficult. How long do you wait for an AJAX response? How long does each Javascript callback (a function waiting for an asynchronous request to complete) take to finish running? These wait times can be tracked, too &ndash; although not with the Navigation Timing API. You might want to check out <a href="https://newrelic.com/browser-monitoring">New Relic Browser Monitoring</a>&hellip;</p>

<p><img class="[AJAX calls]" src="/images/ajax.png" title="[AJAX breakdown [diagram]]" ></p>

<h6>Image: based on screenshot from <a href="https://newrelic.com/browser-monitoring">New Relic Browser - Session Traces</a></h6>

<h3>Various Sources:</h3>

<ul>
<li><a href="http://developer.telerik.com/featured/introduction-navigation-timing-api/">Intro to the Navigation Timing API (blog post)</a></li>
<li><a href="https://davidwalsh.name/measuring-performance">Measuring Performance (blog post)</a></li>
<li><a href="https://blog.newrelic.com/2016/10/17/network-friendly-single-page-apps/">Measuring Performance of Single-Page Apps (blog post)</a></li>
<li><a href="https://newrelic.com/browser-monitoring">New Relic Browser Monitoring</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onload">About the Onload event (MDN docs)</a></li>
<li><a href="http://igoro.com/archive/what-really-happens-when-you-navigate-to-a-url/">FYI, a good explanation of &ldquo;how the Internet works&rdquo;</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-10-20T18:47:44-07:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/browser-ecosystem/'>browser-ecosystem</a>

</div>


	
</div></article>

    
    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/10/05/child-or-prop/">
		
			Child or Prop?</a>
	</h2>
	<div class="entry-content">
		<p>Child or prop? Puppy or bagel?</p>

<p><img class="[Puppy or Bagel]" src="/images/puppyorbagel.jpg" width="450" height="449" title="[Puppy or bagel [puppy or bagel]]" ></p>

<h6>Image: <a href="http://imgur.com/gallery/XsJCNHi">Imgur</a></h6>

<p>Once we get past the amazing likeness of puppies and bagels: let&rsquo;s talk about the similarities and differences between React children and props.</p>

<p>I initially didn&rsquo;t understand the difference. Why have both, if they&rsquo;re just two different ways to pass around information? When should I use props, and when should I use children?</p>

<h3>Parents vs. Owners</h3>

<p>The key to understanding the distinction is understanding the difference between the owner-ownee relationship and the parent-child relationship.</p>

<p>The <strong>parent-child relationship</strong> is a familiar one. For example, a classic DOM layout:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;parent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">&quot;child1&quot;</span><span class="nt">&gt;</span>Child 1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">&quot;child2&quot;</span><span class="nt">&gt;</span>Child 2<span class="nt">&lt;li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The list elements are children of the unordered list. They are literally nested inside the <code>&lt;ul&gt;</code>. In React, too, a child component is literally nested inside the parent: <code>&lt;Parent&gt; &lt;Child /&gt; &lt;/Parent&gt;</code></p>

<p>The <strong>owner-ownee relationship</strong> is a little different. In <a href="https://facebook.github.io/react/docs/multiple-components.html">Facebook&rsquo;s React docs</a> the definition is this:</p>

<blockquote><p>An owner is the component that sets the props of other components. More formally, if a component X is created in component Y&rsquo;s <code>render( )</code> method, it is said that X is <strong>owned</strong> by Y.</p></blockquote>

<p>For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>class Engineer extends React.Component {
</span><span class='line'>    render() {
</span><span class='line'>        return(
</span><span class='line'>            <span class="nt">&lt;pre&gt;</span>
</span><span class='line'>                <span class="nt">&lt;CodeSnippet</span> <span class="na">language=</span><span class="s">{this.props.language}</span> <span class="na">codeSmell=</span><span class="s">{this.props.smell}</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/pre&gt;</span>
</span><span class='line'>        );
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Here, the <code>CodeSnippet</code> is owned by the <code>Engineer</code>, who renders it and is reponsible for its props. (Let that be a lesson to all of us.)</p>

<p>A parent is not the same as an owner. In the above example, <code>pre</code> is the <strong>parent</strong> of <code>CodeSnippet</code>, because a CodeSnippet is nested inside of a <code>pre</code> tag. But <code>pre</code> is not the owner.</p>

<h3>How to pass in children</h3>

<p>This was perhaps the source of my original confusion about children vs. props: children <em>are</em> actually props. But they are a special kind of prop, with their <a href="https://facebook.github.io/react/docs/top-level-api.html#react.children">own set of utilities</a>. The special prop is <code>this.props.children</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>class HasManyChildren extends React.Component {
</span><span class='line'>  render() {
</span><span class='line'>      return (
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;parent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {this.props.children}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      )
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>ReactDOM.render(
</span><span class='line'>  <span class="nt">&lt;HasManyChildren&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Child</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Child</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/HasManyChildren&gt;</span>,
</span><span class='line'>    document.getElementById(&#39;container&#39;)
</span><span class='line'>);
</span></code></pre></td></tr></table></div></figure>


<p>Two children are being passed into the parent <code>HasManyChildren</code> &ndash; and can be accessed with <code>this.props.children</code>.</p>

<h3>Which one??</h3>

<p>So when to use children and when to use regular props as a way to pass down information? The best answer I&rsquo;ve heard so far:</p>

<h5>children are for dynamic content</h5>

<p>Just like with a Ruby <code>yield</code>, you can pass in any children to a component and it can access them with <code>{this.props.children}</code>. For example, maybe you want to render a Ninja component when the user hits the <code>/ninja</code> route, but render a Pirate component if the user lands on <code>/pirate</code>. You can use <code>this.props.children</code> to render either set of components in the React Router.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// in routes</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;ninja&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">NinjaComponent</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;pirate&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">PirateComponent</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// in app.js</span>
</span><span class='line'><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span> <span class="nx">Pirate</span> <span class="nx">or</span> <span class="nx">Ninja</span><span class="o">?</span> <span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span class='line'>        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">}</span> <span class="c1">// renders either PirateComponent or NinjaComponent</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h5>props are like arguments that must be passed in</h5>

<p>Props, however, are the pieces required for components to render. Just like a method&rsquo;s arguments are required for a method call, a component must receive props before it can mount. If a Pirate component must have a priate flag to be rendered, you&rsquo;d better pass one in, matey:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">Pirate</span> <span class="nx">pirateFlag</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">pirateFlag</span><span class="p">}</span> <span class="nx">shipName</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">shipName</span><span class="p">}</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Sources</h3>

<ul>
<li><a href="http://jaketrent.com/post/send-props-to-children-react/">http://jaketrent.com/post/send-props-to-children-react/</a></li>
<li><a href="https://facebook.github.io/react/docs/multiple-components.html">https://facebook.github.io/react/docs/multiple-components.html</a></li>
<li>my awesome coworker</li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-10-05T20:44:25-07:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>

<nav id="pagenavi">
    
    
        <a href="2" class="next">Next</a>
    
    <div class="center"><a href="/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Emily Bookstein

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
